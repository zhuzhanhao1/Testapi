<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<title>朱占豪的快速测试</title>
	<link rel="icon" href="./../static/images/favicon%202.ico">
	<link rel="stylesheet" href="./../static/css/layui.css">
	<script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
	<link href="./../static/bootstrap-3.3.7-dist/css/bootstrap.min.css">
	<script src="./../static/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
	<script src="./../static/js/layui/layui.js"></script>
	<link rel="stylesheet" href="./../static/font-awesome-4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="./../static/css/soulTable.css">
	<style>
		#headers>li input{
			height: 36px;
			line-height: 36px;
			width: 440px;
		}
		#formdatas>li input{
			height: 36px;
			line-height: 36px;
			width: 440px;
		}
		.myinput{
			line-height: 1.3;border-width:1px;border-style:solid;border-radius:2px;border-color:#e6e6e6;padding-left:10px;
		}
		.mybtn{
			text-align: center;
			padding: 0px;
		}
		#method>div>div>input{
			background-color: aliceblue;
		}
	</style>
</head>
<body>
<div class="layui-layout layui-layout-admin" style="margin-left: 100px;">
	<!--快速测试-->
	<div class="layui-row" id="quickTest">
		<div class="modal fade">
			<div class="modal-content">
				<div class="modal-header" style="margin-top: 10px;">
					<img src="./../static/images/quickTest.png" style="margin-left: 460px;">
				</div>
				<div class="modal-body">
					<form class="layui-form"  lay-filter="quickTest">

						<div class="layui-form-item"  style="margin-top: 20px;">
							<label class="layui-form-label">Request</label>
							<div class="layui-inline">
								<div class="layui-input-inline" id= "method" style="width: 120px;">
									<select name="addMethod" id="addMethod">
										<option>GET</option>
										<option>POST</option>
										<option>DELETE</option>
										<option>PUT</option>
									</select>
								</div>
							</div>
							<div class="layui-inline">
								<div class="layui-input-inline">
									<input type="text" name="addUrl" class="layui-input" style="width: 790px;margin-left: -25px;" maxlength="300" id="addUrl" placeholder="url">
								</div>
							</div>
							<div class="layui-inline" style="margin-left: 555px;">
								<button type="submit" class="layui-btn  layui-btn-warm" data-dismiss="modal"
										id="addsubmitBtn" lay-filter="quickTest">Send
								</button>
							</div>
						</div>

{#						<hr class="layui-bg-gray">#}

						<div id="addheadersdiv" name="addheadersdiv" style="margin-top: 30px;">
							<label class="layui-form-label">Headers</label>
							<div class="layui-input-inline">
								<ul id="headers" style="list-style-type: none">
									<li style="margin-bottom:1px;">
										<input id="headers_data" class="addheaders myinput" maxlength="300" name="headers_key"
											   type="text" placeholder="Key"/>
										<input class="addheaders myinput" name="headers_value" type="text" placeholder="Value"/>

										<input id="addheaders" type="button" class="layui-btn  layui-btn-normal mybtn" value="+" style="width: 36px;font-size: 20px;margin-right: -10px;">
										<input id="delheaders" type="button" class="layui-btn  layui-btn-danger mybtn" style="width: 36px;font-size: 20px;" value="-">
										<input id="addmergeheaders" type="text" style="display:None" maxlength="5000" name="addmergeheaders"/>
									</li>
								</ul>
							</div>
						</div>
{#						<hr class="layui-bg-gray">#}
						<div id="addformdatadiv" name="addformdatadiv" style="margin-top: 30px;">
							<label class="layui-form-label">Params</label>
							<div class="layui-input-inline">
								<ul id="formdatas" style="list-style-type: none">
									<li style="margin-bottom:1px;">
										<input type="text" class="addformdata myinput" maxlength="300" name="formdatas_key"
											   placeholder="Key"/>
										<input type="text" class="addformdata myinput" name="formdatas_value" placeholder="Value"/>

										<input id="addformdata" type="button" class="layui-btn  layui-btn-normal mybtn"
											   style="width: 36px;font-size: 20px;margin-right: -10px;"
											   value="+">
										<input id="delformdata" type="button" class="layui-btn  layui-btn-danger mybtn"
											    style="width: 36px;font-size: 20px;"
											   value="-">
										<input id="addmergeformdatas" type="text" style="display:None" maxlength="5000" name="addmergeformdatas"/>
									</li>
								</ul>
							</div>
						</div>
{#						<hr class="layui-bg-gray">#}
						<div class="layui-form-item layui-form-text" style="margin-top: 30px;">
							<label class="layui-form-label">Body</label>
							<div class="layui-input-block">
								<textarea id = "body" name="body" placeholder="仅支持输入JSON格式的内容数据" class="layui-textarea" style="width: 910px;height: 200px;"></textarea>
							</div>
						</div>

						<div class="layui-form-item layui-form-text" style="margin-top: 30px;">
							<label class="layui-form-label">response</label>
							<div class="layui-input-inline">
								<textarea id="response" name="response" class="layui-textarea"
										  style="width: 910px;height: 200px;" placeholder="响应内容在此区域展示"></textarea>
							</div>
							<label class="layui-form-label" style="width: 112px;color: chocolate;font-family:cursive">默认复制结果内容</label><br><br><br>
							<div class="layui-inline">
								<input type="button" class="layui-btn layui-btn-warm" id="jsoncn" value="前往json.cn粘贴"/>
							</div>
						</div>

					</form>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
    //快速测试
    layui.use('form', function () {
        var form = layui.form;
        form.val("quickTest", {});
        //监听编辑用户信息，
        form.on('submit(quickTest)', function (data) {
            console.log(data);
            $.ajax({
                cache: false,
                url: "/quickTest/",
                dataType: 'json',
                type: 'POST',
                //async: false,
                data: {
                    "addURL": $("#addUrl").val(),
                    "Method": $("#addMethod").val(),
                    "addmergeheaders": $("#addmergeheaders").val(),
                    "addmergeformdatas": $("#addmergeformdatas").val(),
                    "body": $("#body").val(),
                },
                beforeSend: function () {
                    l_index = layer.load(0, {shade: [0.5, '#DBDBDB']});
                },
                success: function (data) {
                    console.log(data);
                    var res = JSON.stringify(data, null, 4);
                    console.log(res);
                    $("#response").val(res);
                    layer.msg("操作成功", {
                        icon: 6,
                        offset: 't',
                        time: 1000
                    });

                },
                error: function (data) {
                    console.log(data);
                    layer.msg(data, {
                        icon: 5,
                        offset: 't',
                    });
                },
                complete: function () {
                    layer.close(l_index);
                    //layer.close(a)
                }

            });
            return false;//阻止表单跳转
        });
    });
</script>
<script>
  //增加headers行列
  $(function () {
	  $("#addheaders").click(function () {
		  $("#headers").append("<li style=\"margin-bottom:1px;\">" +
			  "<input class=\"myinput\" type=\"text\" name=\"headers_key\" style=\"margin-right:4px;line-height: 1.3;border-width:1px;border-style:solid;border-radius:2px;border-color:#e6e6e6;\"  placeholder=\"Key\"  />" +
			  "<input class=\"myinput\"  type=\"text\" name=\"headers_value\"  style=\"line-height: 1.3;border-width:1px;border-style:solid;border-radius:2px;border-color:#e6e6e6;\"  placeholder=\"Value\" />" +
			  //"<input id=\"delheaders\" type=\"button\" class=\"layui-btn layui-btn-danger mybtn\" style=\"width: 36px;font-size: 20px;margin-left: 5px;\" value=\"-\">" +
			  "</li>");
	  });
	  $("#delheaders").click(function () {
	      console.log("我是下级删除按钮");
		  if ($("#headers li").length > 1) {
			  $("#headers li:last").remove();
		  }
	  });
  });
  //增加formdata行列
  $(function () {
	  $("#addformdata").click(function () {
		  $("#formdatas").append("<li style=\"margin-bottom:1px;\">" +
			  "<input class=\"myinput\" type=\"text\" name=\"formdatas_key\" style=\"margin-right:4px;line-height: 1.3;border-width:1px;border-style:solid;border-radius:2px;border-color:#e6e6e6;\" placeholder=\"Key\"  />" +
			  "<input  class=\"myinput\" type=\"text\" style=\"line-height: 1.3;border-width:1px;border-style:solid;border-radius:2px;border-color:#e6e6e6;\" name=\"formdatas_value\" placeholder=\"Value\" />" +
			  "</li>");
	  });
	  $("#delformdata").click(function () {
		  if ($("#formdatas li").length > 1) {
			  $("#formdatas li:last").remove();
		  }
	  })
  });
  //提交快速测试的数据
  $("#addsubmitBtn").click(function () {
	  var objone = {};
	  var a = document.querySelectorAll("input[name='headers_key']");
	  var b = document.querySelectorAll("input[name='headers_value']");
	  for (var i = 0; i < a.length; i++) {
		  var keyone = a[i].value;
		  var valueone = b[i].value;
		  objone[keyone] = valueone;
	  }
	  objonestring = JSON.stringify(objone);
	  $("#addmergeheaders").val(objonestring);
	  console.info(objonestring);

	  var objthree = {};
	  var e = document.querySelectorAll("input[name='formdatas_key']");
	  var f = document.querySelectorAll("input[name='formdatas_value']");
	  for (var k = 0; k < e.length; k++) {
		  var keythree = e[k].value;
		  var valuethree = f[k].value;
		  objthree[keythree] = valuethree;
	  }
	  objthreestring = JSON.stringify(objthree);
	  $("#addmergeformdatas").val(objthreestring);
  });
  //打开json.cn
  $("#jsoncn").click(function () {
	  var copyRes = $("#response").select();
	  document.execCommand("Copy");
	  layer.msg("复制成功，打开json.cn", {icon: 6, offset: 't'});
	  layer.open({
		  type: 2,
		  title: "json.cn",
		  skin: 'layui-layer-rim',
		  maxmin: true,
		  moveOut: true,
		  area: ['90%', '90%'],
		  content: "https://www.json.cn",
		  success: function () {
			  console.log("aaaaaaaa");
		  }
	  })
  })


</script>


</body>
</html>
